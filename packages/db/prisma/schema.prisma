generator client {
  provider = "prisma-client-js"
  output   = "../src/.prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Family {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  name      String?
  members   Member[]
}

model Member {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  name    String
  phone   String  @unique
  email   String? @unique
  context Json?

  family   Family    @relation(fields: [familyId], references: [id])
  familyId String
  messages Message[]
}

model Message {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  type       String
  content    String?
  caption    String?
  member     Member      @relation(fields: [memberId], references: [id])
  memberId   String
  from       MessageFrom
  externalId String      @unique
  jid        Json
}

enum MessageFrom {
  ai
  member
}

model Book {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  name         String        @unique
  abbreviation String        @unique
  order        Int
  language     String        @default("pt-BR")
  testament    BookTestament
  chapters     Chapter[]
}

enum BookTestament {
  OT
  NT
}

model Chapter {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  number   Int
  language String  @default("pt-BR")
  bookId   String
  book     Book    @relation(fields: [bookId], references: [id])
  verses   Verse[]

  @@unique([bookId, number])
}

model Verse {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  number    Int
  language  String  @default("pt-BR")
  audio     String?
  voice     String?
  text      String
  chapterId String
  chapter   Chapter @relation(fields: [chapterId], references: [id])

  @@unique([chapterId, number])
}
